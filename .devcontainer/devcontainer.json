// For format details, see https://aka.ms/devcontainer.json.
// Source template: https://github.com/devcontainers/templates/tree/main/src/go
{
  "name": "Seed (Go)",
  "build": { "dockerfile": "Dockerfile" },
  "features": {
    "ghcr.io/devcontainers/features/github-cli:1": {}
  },

  // Forward GitHub CLI tokens from host.
  // Before opening: export GH_TOKEN=$(gh auth token)
  // GITHUB_TOKEN is also forwarded for Codespaces/CI environments.
  "containerEnv": {
    "GH_TOKEN": "${localEnv:GH_TOKEN}",
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}",
    "HOST_WORKSPACE": "${localWorkspaceFolder}"
  },

  // Mount host Claude storage to preserve conversations across host/container contexts.
  // Extensions volume mounts to a staging path (not inside .vscode-server) to avoid
  // Docker creating .vscode-server as root. A symlink connects it at startup via setup.sh.
  // NOTE: ~/.config/gh is intentionally NOT mounted. The host's gh config stores oauth
  // tokens in the system keyring (dbus), which is unavailable in the container. Mounting
  // it causes gh to fail with "dbus-launch not found" even when GH_TOKEN is set. GH_TOKEN
  // forwarding alone is sufficient and avoids the migration failure entirely.
  "mounts": [
    "source=${localEnv:HOME}/.claude,target=/home/vscode/.claude,type=bind,consistency=cached",
    "source=seed-vscode-extensions,target=/home/vscode/.vscode-extensions-cache,type=volume"
  ],

  // Install extensions inside the dev container's remote extension host.
  "customizations": {
    "vscode": {
      "extensions": [
        "anthropics.claude-code"
      ]
    }
  },

  "postCreateCommand": "bash .devcontainer/setup.sh"
}
